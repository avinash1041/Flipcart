{% extends 'Customer/base.html' %}
{% load static %}
{% block title %}Buy Now{% endblock title %}
{% block main-content %}
<div class="container">
 <div class="row mt-5">
  <div class="col-sm-6">
    <h4>Order Summary</h4>
    <hr>
    {% for cart in cart_item %}
      <div class="card mb-2">
        <div class="card-body">
          <h5>Product: {{cart.product.title}}</h5>
          <p>Quantity: {{cart.quantity}}</p>
          <p class="fw-bold">Price: {{cart.total_amount}}</p>
        </div>
      </div>

      {% endfor %}

      <p>Total Amount + Rs. 70<small> (shipping charge)</small> = <strong>{{total_amount}}</strong></p>
      <small><a href="#" style="text-decoration:None">Term and Condition :</a> Please read these conditions carefully before using the Amazon.in website. By using the Amazon.in website, you signify your agreement to be bound by these conditions.

In addition, when you use any current or future Amazon.in service (eg. Wish List or Marketplace) ("Amazon Service"), you will also be subject to the terms, guidelines and conditions applicable to that Amazon Service. ("Terms"). If these Conditions of Use are inconsistent with such Terms, the Terms will control.

These "Conditions of Use" constitute an electronic record within the meaning of the applicable law. This electronic record is generated by a computer system and does not require any physical or digital signatures</small>
  </div>
  <div class="col-sm-4 offset-sm-1">
    <h4>Select Shipping Address</h4>
    <hr>
  <form  action="/paymentdone" id="myform">

      {% for addr in add %}
      <div class="card">
        <div class="card-body">
       <h5><strong class="text-capitalize">{{addr.first_name}} {{addr.last_name}}</strong></h5>
       <p>{{addr.house_no}}, {{addr.street_name}}, {{addr.area_name}}, {{addr.city}},{{addr.state}},{{addr.country}}</p>

        </div>
      </div>
        <div class="form-check mt-2 mb-5">
          <input class="form-check-input" type="radio" name="custid" id="custadd{{forloop.counter}}"
          value="{{addr.id}}">
          <label class="form-check-label fw-bold">
            Address: {{forloop.counter}} </label>
        </div>

      {% endfor %}

        <div class="text-end">
<!--          <button type="submit" class="btn btn-warning mt-3 px-5 fw-bold">Continue</button>-->
                 <div id="paypal-button-container"></div>
        </div>
     </form>
  </div>
</div>
</div>
{% block payment-gatway %}
<script src="https://www.paypal.com/sdk/js?client-id=Acv-lBKP30BhDPPVB4xl3EBB6GQHcJs5m3xeNHduB0Wv_J47agXEYo9mXoCxhIsPc3FtWRNMMZV6qqVT&currency=USD"></script>

    <script>
        // Render the PayPal button into #paypal-button-container
        paypal.Buttons({

            // Set up the transaction
            createOrder: function(data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: '{{total_amount}}'
                        }
                    }]
                });
            },

            // Finalize the transaction
            onApprove: function(data, actions) {
                return actions.order.capture().then(function(details) {
                    // Show a success message to the buyer
                    alert('Transaction completed by ' + details.payer.name.given_name + '!');
                    document.getElementById("myform").submit();
                });
            }


        }).render('#paypal-button-container');
    </script>

{% endblock payment-gatway %}


{% endblock main-content %}